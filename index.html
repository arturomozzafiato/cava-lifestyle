<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>CAVA Lifestyle â€“ Bold Mediterranean Demo</title>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Manrope:wght@700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0b1a2b; --bg2:#1b3c87; --bg3:#2f80ed; /* Aegean gradient */
    --card:#0f172a; --glass:rgba(255,255,255,.06); --line:rgba(255,255,255,.12);
    --text:#f8fafc; --muted:rgba(248,250,252,.72); --good:#34d399; --warn:#f59e0b; --alert:#fb7185;
    --radius:20px; --shadow:0 18px 50px -12px rgba(0,0,0,.55);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text); font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
    background:
      radial-gradient(1400px 800px at 20% -10%, rgba(255,255,255,.10), transparent),
      linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
    background-size:200% 200%; animation:bgMove 26s linear infinite;
  }
  @keyframes bgMove{0%{background-position:0 0}50%{background-position:100% 100%}100%{background-position:0 0}}
  .shell{max-width:440px;margin:0 auto;padding:16px 16px 120px}
  .header{position:sticky;top:0;z-index:30;background:rgba(4,6,12,.6);backdrop-filter:blur(12px);border-bottom:1px solid var(--line)}
  .bar{display:flex;gap:12px;align-items:center;padding:12px 16px}
  h1{font:800 18px Manrope,Inter;margin:0}
  .sub{color:var(--muted);font-size:12px}
  .btn{appearance:none;border:0;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn.primary{background:#fff;color:#0b0f14;box-shadow:var(--shadow)}
  .btn.ghost{background:transparent;color:var(--text);border:1px solid var(--line)}
  .btn.small{padding:8px 10px;font-size:12px;border-radius:10px}
  .card{background:var(--glass);border:1px solid var(--line);backdrop-filter:blur(14px);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
  .hero{overflow:hidden;border-radius:var(--radius);border:1px solid var(--line)}
  .hero img{display:block;width:100%;height:190px;object-fit:cover;opacity:.9}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .tags{display:flex;flex-wrap:wrap;gap:8px}
  .tag{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.08)}
  .tag.disliked{border-color:var(--alert);color:#fecdd3;background:rgba(251,113,133,.15)}
  .price{color:#bbf7d0;font-weight:700}
  /* tabs */
  .tabs{display:flex;gap:8px;margin:10px 0}
  .tab{padding:8px 10px;border-radius:999px;border:1px solid var(--line);cursor:pointer;background:rgba(255,255,255,.06)}
  .tab.active{background:#fff;color:#0b0f14;font-weight:700}
  /* nav */
  .nav{position:fixed;left:0;right:0;bottom:16px;display:flex;justify-content:center;pointer-events:none;z-index:40}
  .navin{pointer-events:auto;display:grid;grid-template-columns:repeat(5,1fr);gap:6px;max-width:440px;margin:0 16px;padding:8px;background:rgba(2,6,12,.55);backdrop-filter:blur(16px);border-radius:18px;border:1px solid var(--line)}
  .navbtn{background:transparent;border:0;color:var(--text);padding:8px;border-radius:12px;font-size:12px;cursor:pointer}
  .navbtn.active{background:rgba(255,255,255,.12);font-weight:700}
  /* modal sheet */
  .overlay{position:fixed;inset:0;background:rgba(2,6,12,.72);display:none;align-items:flex-end;justify-content:center;padding:16px;z-index:50}
  .overlay.show{display:flex}
  .sheet{width:100%;max-width:440px;border:1px solid var(--line);background:rgba(12,18,30,.95);backdrop-filter:blur(20px);border-radius:22px;padding:16px}
  .sheet h3{margin:0 0 8px 0}
  .closeX{background:transparent;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:8px 10px;cursor:pointer}
  canvas{background:#0b0f14;border:1px solid rgba(255,255,255,.2);border-radius:10px}
  /* helpers */
  .hidden{display:none}
  .muted{color:var(--muted)}
  .kpi{display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:6px 8px;border-radius:10px;background:rgba(255,255,255,.08);border:1px solid var(--line);font-size:12px}
</style>
</head>
<body>
  <header class="header" aria-label="Top">
    <div class="bar">
      <div style="font-size:22px">ðŸ¥—</div>
      <div><h1>CAVA Lifestyle</h1><div class="sub">Healthy Â· Mediterranean Â· Fast</div></div>
      <button id="theme" class="btn small ghost" aria-label="Toggle theme">Aegean</button>
      <div id="pts" class="pill" title="Loyalty points">0 pts</div>
    </div>
  </header>

  <main class="shell">
    <!-- HOME -->
    <section id="home">
      <div class="hero card">
        <img id="seasonHero" alt="Seasonal hero image">
        <div style="padding:12px">
          <div class="sub">Seasonal menu</div>
          <div style="font:800 22px Manrope,Inter" id="seasonTitle">â€”</div>
          <div class="sub"><span id="countdown">â€”</span> â€¢ Pairings: <span id="pairings">â€”</span></div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn small primary" id="btnTry">Try seasonal</button>
            <button class="btn small ghost" id="btnStory">Story</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="row">
          <div>
            <div class="sub">AI pick for you</div>
            <div id="pickName" style="font-weight:700">â€”</div>
            <div class="sub" id="pickMeta">â€”</div>
            <div class="kpi" style="margin-top:6px">
              <div id="medScore" class="pill">MedScore â€”</div>
              <div id="carbon" class="pill">Carbon â€”</div>
              <div id="cal" class="pill">â€” kcal</div>
            </div>
          </div>
          <img id="pickImg" alt="dish" style="width:96px;height:96px;object-fit:cover;border-radius:14px;border:1px solid var(--line)">
        </div>
        <div class="row" style="margin-top:8px">
          <div id="pickPrice" class="price">$â€”</div>
          <div style="display:flex;gap:8px">
            <button class="btn small primary" id="orderPick">Order</button>
            <button class="btn small ghost" id="openPass">Pickup Pass</button>
          </div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="row"><div style="font-weight:700">Pantry add-ons</div><div class="sub">Tap to add</div></div>
        <div id="pantry" class="tags" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- MENU -->
    <section id="menu" class="hidden">
      <div class="tabs" role="tablist" aria-label="Diet filters">
        <button class="tab active" data-filter="all" role="tab">All</button>
        <button class="tab" data-filter="veg" role="tab">Vegetarian</button>
        <button class="tab" data-filter="handheld" role="tab">Handheld</button>
        <button class="tab" data-filter="bowl" role="tab">Bowls</button>
      </div>
      <div id="menuList"></div>
    </section>

    <!-- JOURNEY -->
    <section id="journey" class="hidden">
      <div class="card">
        <div style="font-weight:800;margin-bottom:6px">Taste Journey</div>
        <div class="sub">Collect regional stamps to unlock chef drops.</div>
        <div class="tags" style="margin-top:8px">
          <div id="stamp-Greece" class="pill">Greece â¬œ</div>
          <div id="stamp-Levant" class="pill">Levant â¬œ</div>
          <div id="stamp-Maghreb" class="pill">Maghreb â¬œ</div>
        </div>
        <button id="redeem" class="btn small ghost" style="margin-top:10px">Redeem reward</button>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="hidden">
      <div class="card">
        <div style="font-weight:800;margin-bottom:6px">Your preferences</div>
        <label class="row" style="padding:6px 0"><span>Vegetarian</span><input type="checkbox" id="prefVeg"></label>
        <label class="row" style="padding:6px 0"><span>Like it spicy</span><input type="checkbox" id="prefSpicy"></label>
        <div class="row" style="padding:6px 0">
          <span>Budget</span>
          <select id="prefBudget" style="background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--line);border-radius:10px;padding:6px 8px">
            <option value="low">Low</option><option value="medium">Medium</option><option value="high">High</option>
          </select>
        </div>
        <div class="sub">Data controls: this demo stores preferences locally. Toggle any time.</div>
      </div>
      <div class="card" style="margin-top:12px">
        <div class="row"><div style="font-weight:800">Corporate</div>
          <button id="corpCode" class="btn small ghost">Enter code</button></div>
        <div class="sub">Use your company code to unlock stipend & office-drop.</div>
      </div>
      <div class="card" style="margin-top:12px">
        <div style="font-weight:800;margin-bottom:6px">Recent orders</div>
        <ul id="history" class="sub" style="margin:0 0 4px 18px"></ul>
        <button id="reset" class="btn small ghost">Reset demo</button>
      </div>
    </section>
  </main>

  <!-- bottom nav -->
  <nav class="nav" aria-label="Bottom navigation">
    <div class="navin">
      <button class="navbtn active" data-target="home">Home</button>
      <button class="navbtn" data-target="menu">Menu</button>
      <button class="navbtn" data-target="journey">Journey</button>
      <button class="navbtn" data-target="profile">Profile</button>
      <button class="navbtn" id="passQuick">Pass</button>
    </div>
  </nav>

  <!-- pickup pass modal -->
  <div id="overlay" class="overlay" aria-hidden="true" role="dialog" aria-label="Pickup Pass">
    <div class="sheet" role="document">
      <div class="row" style="margin-bottom:8px"><h3>Pickup Pass</h3><button class="closeX" id="closeX" aria-label="Close">Close</button></div>
      <div class="row">
        <canvas id="qr" width="120" height="120" aria-label="Code"></canvas>
        <div>
          <div class="sub">Dynamic PIN</div>
          <div id="pin" style="font:800 28px Manrope,Inter;letter-spacing:4px">â€”</div>
          <div class="sub">Refresh in <span id="refresh">â€”</span>s</div>
          <div class="sub" style="margin-top:6px">Show at pickup â€¢ Scan code or enter PIN</div>
        </div>
      </div>
      <div class="row" style="margin-top:10px">
        <button id="copy" class="btn small primary">Copy PIN</button>
        <button id="simulate" class="btn small ghost">Simulate scan</button>
      </div>
    </div>
  </div>

<script>
/* ---------- Data ---------- */
const IMG={
  greece:"https://images.unsplash.com/photo-1543353071-087092ec393a?q=80&w=1400&auto=format&fit=crop",
  levant:"https://images.unsplash.com/photo-1496116218417-1a781b1c416c?q=80&w=1400&auto=format&fit=crop",
  maghreb:"https://images.unsplash.com/photo-1505577058444-a3dab90d4253?q=80&w=1400&auto=format&fit=crop",
  pita:"https://images.unsplash.com/photo-1589301760014-d929f3979dbc?q=80&w=1600&auto=format&fit=crop",
  bowl:"https://images.unsplash.com/photo-1547592166-23ac45744acd?q=80&w=1600&auto=format&fit=crop",
  mezze:"https://images.unsplash.com/photo-1604908554007-1688f52b0b43?q=80&w=1600&auto=format&fit=crop",
};
const MENU=[
 {id:"1",name:"Harissa Chicken Pita",type:"handheld",region:"Levant",veg:false,spicy:true,cal:610,price:10.95,img:IMG.pita, tags:["protein","harissa","pita"], score:{olive:2,legume:0,veg:2,grain:2,fish:0}},
 {id:"2",name:"Mediterranean Greens Bowl",type:"bowl",region:"Greece",veg:true,spicy:false,cal:520,price:10.45,img:IMG.bowl, tags:["greens","feta","tahini"], score:{olive:2,legume:1,veg:3,grain:1,fish:0}},
 {id:"3",name:"Falafel Mezze Box",type:"mezze",region:"Maghreb",veg:true,spicy:false,cal:560,price:9.95,img:IMG.mezze, tags:["falafel","mezze","shareable"], score:{olive:2,legume:3,veg:2,grain:1,fish:0}},
 {id:"4",name:"Lamb Meatball Plate",type:"plate",region:"Levant",veg:false,spicy:false,cal:680,price:12.25,img:IMG.mezze, tags:["lamb","plate"], score:{olive:1,legume:0,veg:2,grain:1,fish:0}},
 {id:"5",name:"Zhoug Salmon Plate",type:"plate",region:"Levant",veg:false,spicy:true,cal:640,price:13.50,img:IMG.levant, tags:["fish","zhoug","herbs"], score:{olive:2,legume:0,veg:2,grain:1,fish:3}},
];
const SEASONS=[
 {code:"summer-greece",title:"Summer in Greece",hero:IMG.greece, pair:["Lemon-dill tzatziki","Iced mint tea"], story:"Citrus, dill & EVOO. Partner: Peloponnese olive co-op."},
 {code:"autumn-levant",title:"Autumn in the Levant",hero:IMG.levant, pair:["Pomegranate dressing","Spiced lentil soup"], story:"Sumac & pomegranate. Partner: Bekaa Valley grains."},
 {code:"winter-maghreb",title:"Winter in the Maghreb",hero:IMG.maghreb, pair:["Harissa","Couscous"], story:"Preserved lemon & warm spices."},
];

/* ---------- Local state ---------- */
const load=(k,f)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):f}catch{return f}};
const save=(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}};
let prefs=load("prefs",{veg:false,spicy:false,budget:"medium",disliked:[]});
let orders=load("orders",[]);
let points=load("points",0);
let stamps=load("stamps",{Greece:false,Levant:false,Maghreb:false});
let season=load("season",0);

/* ---------- Helpers ---------- */
function carbonEstimate(item){
  // extremely simplified demo: fish/veg lower, red meat higher
  if(item.tags.includes("fish")) return "Low";
  if(item.tags.includes("lamb")) return "High";
  return "Medium";
}
function medScore(s){ // 0-10
  return Math.min(10, s.olive + s.legume + s.veg + s.grain + s.fish);
}
function fitBudget(item){ const b=prefs.budget; return (b==="low"&&item.price<=10)||(b==="medium"&&item.price<=12)||b==="high";}
function aiScore(item){
  let s=0;
  if(prefs.veg===item.veg) s+=1.5;
  if(prefs.spicy===item.spicy) s+=1.0;
  if(fitBudget(item)) s+=1.0;
  if(prefs.disliked.some(d=>item.tags.includes(d))) s-=4;
  const times=orders.filter(o=>o.id===item.id).length;
  s+= times===0?1.2:Math.max(0,.8-times*.2);
  s+= medScore(item.score)/10; // bias towards healthier Med composition
  return s;
}
function pickAI(){ return [...MENU].sort((a,b)=>aiScore(b)-aiScore(a))[0];}
function fmt$ (n){return "$"+n.toFixed(2)}
function inDays(d){ const t=Date.now(), diff=new Date(d).getTime()-t; const days=Math.max(0,Math.floor(diff/86400000)); const h=Math.max(0,Math.floor((diff%86400000)/3600000)); const m=Math.max(0,Math.floor((diff%3600000)/60000)); return `${days}d ${h}h ${m}m`; }
function nextDropISO(){ const d=new Date(); d.setDate(d.getDate()+6); return d.toISOString(); }
function pinNow(){ const slot=Math.floor(Date.now()/20000); const pin=(slot%1000000).toString().padStart(6,"0"); const left=20-Math.floor((Date.now()/1000)%20); return {pin, left};}
function drawQR(canvas, seed){
  const N=21, ctx=canvas.getContext("2d"); const cell=Math.floor(canvas.width/N);
  ctx.fillStyle="#0b0f14"; ctx.fillRect(0,0,canvas.width,canvas.height);
  // simple hash â†’ pseudo pattern
  let h=0; for(let i=0;i<seed.length;i++){h=((h<<5)-h)+seed.charCodeAt(i);h|=0;}
  for(let i=0;i<N*N;i++){ const on=(h>>(i%31)) & 1; if(on){ const x=(i%N)*cell, y=Math.floor(i/N)*cell; ctx.fillStyle="#fff"; ctx.fillRect(x+1,y+1,cell-2,cell-2); } }
}

/* ---------- Renderers ---------- */
function renderSeason(){
  const s=SEASONS[season%SEASONS.length];
  document.getElementById("seasonHero").src=s.hero;
  document.getElementById("seasonTitle").textContent=s.title;
  document.getElementById("pairings").textContent=s.pair.join(" Â· ");
  document.getElementById("countdown").textContent=inDays(nextDropISO());
}
function renderAI(){
  const it=pickAI();
  document.getElementById("pickName").textContent=it.name;
  document.getElementById("pickMeta").textContent=`${it.region} Â· ${it.type}`;
  document.getElementById("pickImg").src=it.img;
  document.getElementById("pickPrice").textContent=fmt$(it.price);
  document.getElementById("medScore").textContent=`MedScore ${medScore(it.score)}/10`;
  document.getElementById("carbon").textContent=`Carbon ${carbonEstimate(it)}`;
  document.getElementById("cal").textContent=`${it.cal} kcal`;
}
function renderPantry(){
  const host=document.getElementById("pantry"); host.innerHTML="";
  ["Hummus","Tzatziki","Pita","Grain Kit"].forEach(p=>{
    const b=document.createElement("button"); b.className="tag"; b.textContent="+ "+p;
    b.onclick=()=>{ orders.unshift({id:"pantry-"+p,name:p,price:2.00,ts:Date.now()}); points+=2; save("points",points); renderPoints(); alert("Added: "+p);}
    host.appendChild(b);
  });
}
function renderMenu(filter="all"){
  const root=document.getElementById("menuList"); root.innerHTML="";
  MENU.filter(m=>{
    if(filter==="veg") return m.veg;
    if(filter==="handheld") return m.type==="handheld";
    if(filter==="bowl") return m.type==="bowl";
    return true;
  }).forEach(m=>{
    const card=document.createElement("div"); card.className="card"; card.style.marginTop="10px";
    const row=document.createElement("div"); row.className="row";
    const left=document.createElement("div");
    left.innerHTML=`<div style="font-weight:800">${m.name}</div>
                    <div class="sub">${m.region} Â· ${m.type}</div>
                    <div class="tags" style="margin-top:6px">${m.tags.map(t=>`<span class="tag ${prefs.disliked.includes(t)?'disliked':''}">#${t}</span>`).join("")}</div>`;
    const img=document.createElement("img"); img.src=m.img; img.alt=m.name; img.style="width:96px;height:96px;object-fit:cover;border-radius:14px;border:1px solid var(--line)";
    row.append(left,img);
    const foot=document.createElement("div"); foot.className="row"; foot.style.marginTop="8px";
    const kpis=document.createElement("div"); kpis.className="kpi";
    kpis.innerHTML=`<div class="pill">MedScore ${medScore(m.score)}/10</div><div class="pill">${m.cal} kcal</div><div class="pill">${carbonEstimate(m)}</div>`;
    const r=document.createElement("div");
    r.innerHTML=`<span class="price">${fmt$(m.price)}</span>`;
    const act=document.createElement("div"); act.style.display="flex"; act.style.gap="8px";
    const add=document.createElement("button"); add.className="btn small primary"; add.textContent="Add";
    add.onclick=()=>placeOrder(m);
    foot.append(kpis, act);
    act.append(r,add);
    card.append(row,foot);
    // clickable tags to dislike/undo
    card.querySelectorAll(".tag").forEach(el=>{
      el.onclick=()=>{ const tag=el.textContent.replace("#",""); toggleDislike(tag); renderMenu(filter); renderAI(); };
    });
    root.appendChild(card);
  });
}
function renderJourney(){
  document.getElementById("stamp-Greece").textContent=`Greece ${stamps.Greece?"âœ…":"â¬œ"}`;
  document.getElementById("stamp-Levant").textContent=`Levant ${stamps.Levant?"âœ…":"â¬œ"}`;
  document.getElementById("stamp-Maghreb").textContent=`Maghreb ${stamps.Maghreb?"âœ…":"â¬œ"}`;
}
function renderProfile(){
  document.getElementById("prefVeg").checked=prefs.veg;
  document.getElementById("prefSpicy").checked=prefs.spicy;
  document.getElementById("prefBudget").value=prefs.budget;
  const ul=document.getElementById("history"); ul.innerHTML="";
  orders.slice(0,6).forEach(o=>{ const li=document.createElement("li"); li.textContent=`${o.name}`; ul.appendChild(li);});
}
function renderPoints(){ document.getElementById("pts").textContent = `${points} pts`; }

/* ---------- Actions ---------- */
function placeOrder(item){
  orders=[{id:item.id,name:item.name,price:item.price,ts:Date.now()},...orders]; save("orders",orders);
  points+=10; save("points",points);
  if(stamps[item.region]===false) { stamps[item.region]=true; save("stamps",stamps); }
  alert(`Ordered: ${item.name}  +10 pts`);
  renderAI(); renderJourney(); renderProfile(); renderPoints();
}
function toggleDislike(tag){
  if(prefs.disliked.includes(tag)) prefs.disliked=prefs.disliked.filter(t=>t!==tag);
  else prefs.disliked.push(tag);
  save("prefs",prefs);
}

/* ---------- Tabs & Filters ---------- */
document.querySelectorAll(".navbtn").forEach(b=>{
  b.addEventListener("click",()=>{
    const t=b.dataset.target;
    document.querySelectorAll(".navbtn").forEach(x=>x.classList.toggle("active",x===b));
    ["home","menu","journey","profile"].forEach(id=>document.getElementById(id).classList.toggle("hidden",id!==t));
    if(t==="menu") renderMenu(document.querySelector(".tab.active").dataset.filter);
  });
});
document.querySelectorAll(".tab").forEach(tb=>{
  tb.addEventListener("click",()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    tb.classList.add("active");
    renderMenu(tb.dataset.filter);
  });
});

/* ---------- Preferences ---------- */
document.getElementById("prefVeg").onchange=e=>{prefs.veg=e.target.checked; save("prefs",prefs); renderAI(); renderMenu(document.querySelector(".tab.active").dataset.filter);}
document.getElementById("prefSpicy").onchange=e=>{prefs.spicy=e.target.checked; save("prefs",prefs); renderAI();}
document.getElementById("prefBudget").onchange=e=>{prefs.budget=e.target.value; save("prefs",prefs); renderAI();}
document.getElementById("reset").onclick=()=>{ localStorage.clear(); location.reload(); }
document.getElementById("corpCode").onclick=()=>{ const c=prompt("Enter company code (demo accepts: CAVA)"); alert(c==="CAVA"?"Stipend unlocked (demo)":"Invalid code (demo)"); }

/* ---------- Seasonal actions ---------- */
document.getElementById("btnTry").onclick=()=>placeOrder(pickAI());
document.getElementById("btnStory").onclick=()=>{ season=(season+1)%SEASONS.length; save("season",season); renderSeason(); }

/* ---------- Pickup Pass (accessible, closable) ---------- */
const overlay=document.getElementById("overlay");
const openers=[document.getElementById("openPass"),document.getElementById("passQuick")];
openers.forEach(o=>o.addEventListener("click",()=>showPass(true)));
document.getElementById("closeX").addEventListener("click",()=>showPass(false));
overlay.addEventListener("click",(e)=>{ if(e.target===overlay) showPass(false); }); // click outside to close
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") showPass(false); });
let passTimer=null;
function showPass(open){
  overlay.classList.toggle("show",open);
  overlay.setAttribute("aria-hidden", open?"false":"true");
  if(open){
    updatePIN(); passTimer=setInterval(updatePIN,1000);
    // focus trap (simple)
    document.getElementById("closeX").focus();
    document.body.style.overflow="hidden";
  }else{
    clearInterval(passTimer); passTimer=null; document.body.style.overflow="";
  }
}
function updatePIN(){
  const {pin,left}=pinNow();
  document.getElementById("pin").textContent=pin.slice(0,3)+" "+pin.slice(3);
  document.getElementById("refresh").textContent=left;
  drawQR(document.getElementById("qr"), pin);
}
document.getElementById("copy").onclick=()=>{ const t=document.getElementById("pin").textContent.replace(/\s/g,""); navigator.clipboard?.writeText(t); alert("PIN copied: "+t); }
document.getElementById("simulate").onclick=()=> alert("Scan OK âœ“ â€” order released");

/* ---------- Theme toggle ---------- */
document.getElementById("theme").onclick=()=>{
  const c=document.documentElement.style;
  const current=c.getPropertyValue("--bg1");
  // cycle Aegean â†’ Terracotta â†’ Marrakesh
  if(current==="" || current==="#0b1a2b"){ // to Terracotta
    c.setProperty("--bg1","#8D4D3A"); c.setProperty("--bg2","#E76F51"); c.setProperty("--bg3","#F4A261");
    document.getElementById("theme").textContent="Terracotta";
  }else if(current==="#8D4D3A"){ // to Marrakesh
    c.setProperty("--bg1","#028090"); c.setProperty("--bg2","#00A896"); c.setProperty("--bg3","#2EC4B6");
    document.getElementById("theme").textContent="Marrakesh";
  }else{ // back to Aegean
    c.setProperty("--bg1","#0b1a2b"); c.setProperty("--bg2","#1b3c87"); c.setProperty("--bg3","#2f80ed");
    document.getElementById("theme").textContent="Aegean";
  }
};

/* ---------- Points / Journey ---------- */
document.getElementById("redeem").onclick=()=>{
  if(stamps.Greece && stamps.Levant && stamps.Maghreb){ points+=100; save("points",points); alert("Redeemed +100 pts!"); }
  else alert("Collect all stamps first.");
  renderPoints();
}

/* ---------- Init ---------- */
function init(){
  renderSeason(); renderAI(); renderPantry(); renderMenu("all"); renderJourney(); renderProfile(); renderPoints();
  // season countdown refresh
  setInterval(()=>{ document.getElementById("countdown").textContent=inDays(nextDropISO()); },60000);
}
init();
</script>
</body>
</html>
